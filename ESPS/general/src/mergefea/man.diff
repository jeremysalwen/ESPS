.\" Copyright (c) 1989-1990 Entropic Speech, Inc.
.\" Copyright (c) 1992 Entropic Research Laboratory, Inc. All rights reserved.
.\" @(#)mergefea.1	1.11 03 Apr 1997 ESI/ERL
.ds ]W (c) 1992 Entropic Research Laboratory, Inc.
.TH MERGEFEA 1\-ESPS 03 Apr 1997
.SH "NAME"
mergefea - merge two FEA files so that output records contain fields from both
.SH "SYNOPSIS"
.B mergefea
[
.BI \-f " field_name"
] . . . [
.B \-t
] [
.B \-u
] [
.B \-a
] [
.BI \-x " debug_level"
] [
.B \-z
] [
.BI \-T " FEA_subtype"
] 
.I "fea1 fea2"
[
.I "fea3"
]
.SH "DESCRIPTION"
.PP
If \fIfea1\fP and \fIfea2\fP both exist, \fImergefea\fR merges their
records in the sense that the fields in each output record comprise
the union of fields in two input records.  The results of the merge 
can be written to a third file \fIfea3\fP, or \fIfea2\fP can be 
rewritten to contain the merged results (think of this as merging
\fIfea1\fP into \fIfea2\fP).  The \fB\-f\fP option can be used to 
restrict which fields are taken from the \fIfea1\fP records.  
If \fIfea2\fP doesn't exist, it is created and contains only
the selected fields from \fIfea1\fP (thus, \fImergefea\fP can be
used to filter fields out of FEA files). 
.PP
If both input files exist, then each record of the output contains all
of the fields from the corresponding \fIfea2\fP record and the selected
fields from the corresponding \fIfea1\fP record (all of them unless
the \fB\-f\fP option is used).  None of the selected fields from
\fIfea1\fP may have the same name as a field in  \fIfea2\fP.  The size
of the output file is determined by the size of \fIfea2\fP \- they have
the same number of records.  If \fIfea1\fP has more records than
\fIfea2\fP, then the additional records are ignored.  If \fIfea1\fP has
fewer records than \fIfea2\fP, then the field values in the last record
of \fIfea1\fP are duplicated for merging with the additional \fIfea2\fP
records.  If \fIfea3\fP is supplied, then the output is written to
\fIfea3\fP, and the original contents of \fIfea2\fP are left unchanged.
If \fIfea3\fP is not supplied, then the contents of the output file
replace the previous contents of \fIfea2\fP.  That is, \fImergefea\fP
rewrites \fIfea2\fP with additional fields in each record.
.PP
If \fIfea2\fP  does not exist, it is created as an output file,
and \fIfea3\fP must not be supplied.
.PP
Generic header items are copied from input to output.  If \fIfea1\fP
and \fIfea2\fP contain header items with the same name, the value in
\fIfea2\fP prevails.  This behavior can be changed by using the
\fB\-u\fP option, which causes all generics from \fIfea1\fP to be copied;
unique new names are generated if generics by the same name already exist
in \fIfea2\fP).  
.PP
If \fIfea1\fP is "\-", standard input is used.  If \fIfea3\fP is not
supplied and \fIfea2\fP is "\-", standard output is used (in this
case, \fImergefea\fP is just a field filter).  If \fIfea3\fP is
supplied and \fIfea2\fP is "\-", standard input is used,
but \fIfea1\fP and \fIfea2\fP may not both be standard input.
If \fIfea3\fP is "\-", standard output is used.
.SH OPTIONS
.PP
The following options are supported:
.TP
.BI \-f " field_name" 
Specifies a field name to be taken from \fIfea1\fP.  If no \fB\-f\fP
option is given, all fields are taken.  This option may be given more
than once.
.TP
.B \-t
This option makes the output file a tagged file and
causes record \fItag\fR values to be copied from \fIfea1\fP
to the output file, along with the specified feature fields.
If the option is not specified, then the output file is tagged
if and only if \fIfea2\fP exists and is tagged, and the \fItag\fP
values, if any, are copied from \fIfea2\fP.
.TP
.B \-u
If generic header items in \fIfea1\fP have names that exist already
as generics in \fIfea2\fP, this option causes those items in \fIfea1\fP
to be copied with unique new names generated by the use of
\fIcopy_genhd_uniq\fP (3\-\s-1ESPS\s+1).  Numerical digits are appended
to the generic header item names in order to render them unique (see
\fIuniq_name\fP (3\-\s-1ESPS\s+1)).
.TP
.B \-a
If the selected fields in \fIfea1\fP and all fields in \fIfea2\fP have
non-conflicting names, and if both \fIfea1\fP and \fIfea2\fP have the
generic header items \fIrecord_freq\fR and \fIstart_time\fR defined, then 
this option can be used to merge the files in a time-aligned manner.
The output file \fIfea3\fP has the same record frequency \fIrecord_freq\fR
as \fIfea2\fP, and it consists of records that correspond to the time
intersection of the two input files.  In case that input record frequencies
differ, a zero-th order (or nearest-neighbor) interpolation scheme is 
performed on records of \fIfea1\fP.
.TP
.BI \-x " debug_level \fR[0]\fP"
If \fIdebug_level\fP is positive,
.I mergefea
outputs debugging messages. The messages proliferate as 
.I debug_level 
increases.  For level 0, there is no output.
.TP
.B \-z
Suppress the warning that is normally printed if \fIrecord_freq\fP
is defined with different values in the two input files.
.TP
.BI \-T " FEA_subtype \fR[(same as \fIfea2\fR)]"
If this option is given, the feature file subtype code in the output file
is filled in with the given code.
The symbolic name of the subtype code must be given,
for example FEA_ANA or FEA_SD (or NONE).
For a complete list of defined subtype codes, see FEA(5\-ESPS).
Use of this option doesn't ensure
that the file has the correct format for the specified subtype.
You should use this option only when you knows that a file
with the correct fields and generic header items will be produced.
See the section 5 manual pages for the defined feature file types.
.SH "ESPS PARAMETERS"
.PP
No parameter file is used by \fImergefea\fP.  
.SH "ESPS COMMON"
.PP
ESPS Common is not read or written by \fImergefea\fP.  
.SH ESPS HEADERS
.PP
The generic header items from both input files are added as generic
header items to the output file.  If generic header items with the same
name exist in both input files, the value from \fIfea2\fP is used
(but see the \fB\-u\fP option).
.PP
The input files \fIfea1\fP and \fIfea2\fP, if both exist,
are added as source files in the output header;
otherwise only \fIfea1\fP is added.
The generic header items \fIstart_time\fP and \fIrecord_freq\fP
are handled like any others.
In addition, if \fIrecord_freq\fP is defined with different values
in the two input files, the program prints a warning.
The  \fB\-z\fP option will suppress the warning.
.PP
If
.I fea2
exists, its FEA subtype code is preserved in the output
unless a different choice is specified with the
.B \-T
option.
.SH "FUTURE CHANGES"
.PP
Add range processing options.  
.PP
Add parameter file processing. 
.SH "SEE ALSO"
.PP
\fIuniq_name\fP (3\-\s-1ESPS\s+1), \fIcopy_genhd\fP (3\-\s-1ESPS\s+1),
.br
\fIcopy_genhd_uniq\fP (3\-\s-1ESPS\s+1), \fIcopysps\fP (1\-\s-1ESPS\s+1),
.br
\fIfea_deriv\fP (1\-\s-1ESPS\s+1), \fIaddfea\fP (1\-\s-1ESPS\s+1),
.br
\fIaddgen\fP (1\-\s-1ESPS\s+1) \fIaddfeahd\fP (1\-\s-1ESPS\s+1),
\fIselect\fP (1\-\s-1ESPS\s+1), 
.br
\fIfeafunc\fP (1\-\s-1ESPS\s+1),
\fIfea_edit\fP (1\-\s-1ESPS\s+1)
.SH "WARNINGS AND DIAGNOSTICS"
.PP
\fIMergefea\fP will exit with an error message
if \fIfea1\fP, and \fIfea2\fP if it exists, are not ESPS FEA files;
if "\-" is given for both \fIfea1\fP and \fIfea2\fP and \fIfea3\fP is given;
if \fIrecord_freq\fP is defined with different values in the two input files;
if fields named by a \fB\-f\fP option do not exist in \fIfea1\fP;
or if fields to be merged in from \fIfea1\fP
already exist in \fIfea2\fP.
Note that field names
can be changed by using \fIfeafunc\fP (1\-\s-1ESPS\s+1) or by running
\fIfea_edit\fP (1\-\s-1ESPS\s+1) and editing the self-description.
.SH "BUGS"
.PP
None known.
.SH "AUTHOR"
.PP
Manual page by John Shore.  Program by Alan Parker, with revisions by
John Shore.
